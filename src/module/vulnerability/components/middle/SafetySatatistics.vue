<template>
<div class="el-panel">
  <div class="el-panel-heading">
    <h4 class="el-panel-title">安全概况</h4>
  </div>
  <div class="el-panel-body echartmapbox3" style="position: relative;">
    <!-- <div class="tit-map" style="text-align: center;">
      <div class="tit-label"><label>新增漏洞</label><span>{{vulstat.total.toLocaleString()}}</span></div>
      <div class="tit-label"><label>新增预警</label><span>{{vulstat.total.toLocaleString()}}</span></div>
      <div class="tit-label"><label>涉及资产</label><span>{{vulstat.asset.toLocaleString()}}</span></div>
    </div> -->
    <ul class="tip-map">
      <li>
        <label>新增漏洞</label>
        <span class="text-color1">{{vulstat.total.toLocaleString()}}</span>
      </li>
      <li>
        <label>新增漏洞</label>
        <span class="text-color2">{{vulstat.total.toLocaleString()}}</span>
      </li>
      <li>
        <label>涉及资产</label>
        <span class="text-color3">{{vulstat.asset.toLocaleString()}}</span>
      </li>
    </ul>
    <div class="echartbox12 mapbar">
       <e-charts :options="option" auto-resize></e-charts>
    </div>
    <div class="echartmapbox3" id="WorldMapA">
      <e-charts :options="option1" auto-resize></e-charts>
    </div>
    <div class="btn-map btn-map-c">
      <!-- <el-button type="text" id="wd-btn" @click="changeView('wd')"><i :class="['icon_wd', viewType==='wd'?'icon-active':'']"></i></el-button> -->
      <el-button type="text" id="cn-btn" @click="changeView('cn')"><i :class="['icon_cn', viewType==='cn'?'icon-active':'']"></i></el-button>
      <el-button type="text" id="ty-btn" @click="changeView('ty')"><i :class="['icon_iw', viewType==='ty'?'icon-active':'']"></i></el-button>
    </div>

  </div>
</div>
</template>

<script>
import{ geoCoordMap,convertData,cnoption } from 'static/js/map/echart-chinaweb.js'
// import wdoption from 'static/js/map/echart-worldweb.js'
import ECharts from 'components/vue-echarts/ECharts.vue'
import tymapoption from 'static/js/map/echart-taiyuanweb.js'
let wdchart = {};
export default {
  components: {
    ECharts,
  },
  data() {
    return {
      viewType: 'cn',
      option : {},
      option1 : {},
      vulstat: {
        total: '',
        asset: ''
      },
      scanType: {
        '1': 'web漏洞',
        '2': '主机漏洞',
        '3': '弱口令'
      }
    }
  },
  methods: {
    changeView(type) {
      this.viewType = type;
      //wdchart.clear();
      // if(type === 'wd') {
      //   wdchart.setOption(wdoption);
      // }else
      if (type === 'cn') {
        this.option1=cnoption;
        //wdchart.setOption(cnoption);
      } else {
        this.option1=tymapoption;
        //wdchart.setOption(tymapoption);
      }
    },
    getInitData() {
      this.common.req('/ssa/vulnerabilitystat/getVulerablityMap.do', {}, this).then((data) => {
        cnoption.series[0].data = convertData(data.map);
        this.option1=cnoption;
        //wdchart.setOption(cnoption);
        this.loadMapChart(data);
        this.vulstat = data;
      })
    },
    loadMapChart(data) {
      //let myChart = echarts.init(document.getElementById('vulnerabilitymapbar'));
      for (let b of data.bar) {
        b.name = this.scanType[b.type];
      }
      let result = data.bar;
      let colors = ['#0065ba','#038cff', '#12cbf6'];
      let offsets = [[0, -50], [0, -40], [0, -25]];
      let s = [];
      for(let i = 0 ; i < result.length; i++) {
        if(result[i].value !== 0) {
          let su = {
            name: result[i].name,
            type: 'bar',
            stack: '安全概况',
            itemStyle: {
              normal: {
                color: colors[i],
              }
            },
            label: {
              normal: {
                show: true,
                color: '#747a82',
                fontSize: '14',
                position: 'right',
                offset: offsets[i],
                formatter: [
                  '{a|{a}}',
                  '{b|{c}}'
                ].join('\n'),
                rich: {
                  a: {
                    color: '#747a82',
                    fontSize: '14',
                    lineHeight: 25,
                  }
                }
              }
            },
            data: [result[i].value]
          };
          s.push(su);
        }
      }
      this.option = {
        grid: {
          left: '3%',
          right: '85%',
          top: '10%',
          bottom: '3%',
          containLabel: false
        },
        xAxis: [{
          type: 'category',
          axisLine: {
            show: false
          },
          axisTick: {
            show: false
          },
          axisLabel: {
            show: false
          },
          splitLine: {
            show: false,
          },
          data: ['周一']
        }],
        yAxis: [{
          type: 'value',
          axisLine: {
            show: false
          },
          axisTick: {
            show: false
          },
          axisLabel: {
            show: false
          },
          splitLine: {
            show: false,
          },
        }],
        series: s

      };
      // myChart.setOption(option);
      // window.onresize = myChart.resize;

    }

  },
  created: function() {

  },
  mounted: function() {
    //wdchart = echarts.init(document.getElementById('WorldMapA'));
    this.getInitData();
  }
}
</script>

<style>

</style>
