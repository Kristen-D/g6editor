<template>
<div>
  <div class="el-panel">
    <span class="left-top"></span><span class="left-bottom"></span>
    <span class="right-top"></span><span class="right-bottom"></span>
    <div class="el-panel-heading">
      <h4 class="el-panel-title">漏洞类型TOP</h4>
    </div>
    <div class="el-panel-body shine">
      <div class="text-center" style="margin:10px auto auto">
        <h4 class="el-subtitle">共挖掘<span class="digital">{{typeTotal}}</span>种类型</h4>
      </div>
      <div class="echartsbox2" id="pie1"></div>
      <div class="">
        <h4 class="el-subtitle">TOP3</h4>
        <ul class="list-bar m-b-40">
          <li style="position:relative;">
            <div class="progressbar showHover">
              <div ref="pernum1" class="progress-bar progress-bar-info animated progress-animated"></div>
            </div>
            <div class="progresstext">
              <label>{{name1}}</label>
              <span class="float-r">{{top1num}}个</span>
            </div>
            <div class="showLoopholeTop">
              <p>{{name1}}:</p>
              <p>{{top1num}}个</p>
            </div>
          </li>
          <li style="position:relative;">
            <div class="progressbar showHover">
              <div ref="pernum2" class="progress-bar progress-bar-primary animated progress-animated"></div>
            </div>
            <div class="progresstext">
              <label>{{name2}}</label>
              <span class="float-r">{{top2num}}个</span>
            </div>
            <div class="showLoopholeTop">
              <p>{{name2}}:</p>
              <p>{{top2num}}个</p>
            </div>
          </li>
          <li style="position:relative;">
            <div class="progressbar showHover">
              <div ref="pernum3" class="progress-bar progress-bar-blue animated progress-animated"></div>
            </div>
            <div class="progresstext">
              <label>{{name3}}</label>
              <span class="float-r">{{top3num}}个</span>
            </div>
            <div class="showLoopholeTop">
              <p>{{name3}}:</p>
              <p>{{top3num}}个</p>
            </div>
          </li>
        </ul>
      </div>
    </div>
  </div>

</div>
</template>
<script>

export default {
  data() {
    return {
      typeList :[],
      total: null,
      typeTotal: null,
      top1num: null,
      top2num: null,
      top3num: null,
      name1: "",
      name2: "",
      name3: "",
    }
  },

  methods: {

    loadProgress(){
      var per1 = this.top1num / this.total;
      var per2 = this.top2num / this.total;
      var per3 = this.top3num / this.total;
      this.$refs.pernum1.style.width = per1 * 100 + "%";
      this.$refs.pernum2.style.width = per2 * 100 + "%";
      this.$refs.pernum3.style.width = per3 * 100 + "%";
    },

    loadChart(data) {
      var myChart1 = echarts.init(document.getElementById('pie1'));
      var option1 = {
        tooltip: {
          trigger: 'item',
          formatter: "{b}: {c} ({d}%)"
        },
        series: [{
          name: '访问来源',
          type: 'pie',
          color: ['#0776b8', '#a4cee5', '#3658ff', '#3bafff', '#00f6ff'],
          radius: ['52%', '75%'],
          center: ['50%', '50%'],
          avoidLabelOverlap: false,
          label: {
            normal: {
              show: false
            }
          },
          labelLine: {
            normal: {
              show: false
            }
          },
          itemStyle: { //图形样式
            normal: {
              borderWidth: 2,
              borderColor: '#000',
            }
          },
          data: data
        }]
      };

      myChart1.setOption(option1);
      window.onresize = myChart1.resize();
    }
  },
  mounted() {
    // 鼠标滑过显示/隐藏提示内容
    $(".list-bar>li>.showHover").hover(function() {
      $(this).siblings(".showLoopholeTop").show();
    }, function() {
      $(this).siblings(".showLoopholeTop").hide();
    });

    this.common.req("/ssa/vulnerability/getVulnerabilityGroupByType.do").then(data => {
      this.typeList = data.typeList;
      this.total = data.total;
      this.typeTotal = data.typeTotal;
      this.top1num  = this.typeList[0].value;
      this.top2num  = this.typeList[1].value;
      this.top3num  = this.typeList[2].value;
      this.name1 = this.typeList[0].name;
      this.name2 = this.typeList[1].name;
      this.name3 = this.typeList[2].name;
      this.loadChart(this.typeList);
      this.loadProgress();
    });



  }
}
</script>
<style>
.showLoopholeTop {
  width: 60px;
  height: 40px;
  background-color: rgba(111, 111, 111, 0.3);
  position: absolute;
  top: 5px;
  right: -50px;
  border-radius: 3px;
  text-align: center;
  font-size: 16px;
  vertical-align: middle;
  color: white;
  display: none;
}
</style>
