<template>
<div>
  <div class="el-panel">
    <span class="left-top"></span><span class="left-bottom"></span>
    <span class="right-top"></span><span class="right-bottom"></span>
    <div class="el-panel-heading">
      <h4 class="el-panel-title">严重程度</h4>
    </div>
    <div class="el-panel-body shine">
      <div class="echartsbox3" id="pie2"></div>
      <ul class="level m-b-20 clearfloat">
        <li><span class="circle circle-deepred"></span><label>极高</label><span class="float-r">{{veryhight}}%</span></li>
        <li><span class="circle circle-red"></span><label>高</label><span class="float-r">{{hight}}%</span></li>
        <li><span class="circle circle-orange"></span><label>中</label><span class="float-r">{{middle}}%</span></li>
        <li><span class="circle circle-yellow"></span><label>低</label><span class="float-r">{{low}}%</span></li>
      </ul>
    </div>
  </div>
</div>
</template>
<script>
export default {
  data() {
    return {
      levelList: [],
      veryhight: null,
      hight: null,
      middle: null,
      low: null,
    }
  },

  methods: {
    loadChart() {
      var myChart2 = echarts.init(document.getElementById('pie2'));
      var option2 = {
        color: ['#c0392b', '#fe5722', '#fe9700', '#feea3b'],
        tooltip: {
          trigger: 'item',
          formatter: "等级:{b} <br/>占比:{d}%<br/>数量:{c}"
        },
        calculable: true,
        series: {
          type: 'pie',
          radius: ['40%', '70%'],
          center: ['50%', '50%'],
          roseType: 'radius',
          label: {
            normal: {
              show:true,
              textStyle: {
                        fontSize: 12,
                        color: '#47a8f1'
                    }
            }
          },
          labelLine:{//标签的视觉引导线样式
            normal:{
              length:6,
              length2:15,
              lineStyle:{color:'#47a8f1',opacity:'0.6'}, 		}
             },
          data: this.levelList
        }
      };
      myChart2.setOption(option2);
      window.onresize = myChart2.resize();
    }
  },
  mounted: function() {

    this.common.req("/ssa/vulnerability/getVulnerabilityGroupByLevel.do").then(data => {
      this.levelList = data.levelList;
      var total = data.total;


      for (var i in this.levelList) {
        if (this.levelList[i].name == '超危') {
          var vh = this.levelList[i].value / total * 100;
          this.veryhight = vh.toFixed(1);
        } else if (this.levelList[i].name == '高危') {
          var h = this.levelList[i].value / total * 100;
          this.hight = h.toFixed(1);
        } else if (this.levelList[i].name == '中危') {
          var m = this.levelList[i].value / total * 100;
          this.middle = m.toFixed(1);
        } else if (this.levelList[i].name == '低危') {
          var l = this.levelList[i].value / total * 100;
          this.low = l.toFixed(1);
        }
      }
      this.loadChart();
    });

  }
}
</script>
